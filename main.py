import uasyncio as asyncio
import time
import _thread
import initialization as fu
from display import Display, QueueItem
from display_helper import WINKING_POTATO

i2c_h = fu.init_i2c()
fu.i2c_eeprom_init(i2c_h)
oled_h = fu.init_oled(i2c_h)

#house = {'construction': [{'absolute_location': [0, 15], 'local_location': [0, 0], 'material_type': 'House_Wall', 'passable': False}, {'absolute_location': [0, 16], 'local_location': [0, 1], 'material_type': 'Air', 'passable': True}, {'absolute_location': [0, 17], 'local_location': [0, 2], 'material_type': 'Air', 'passable': True}, {'absolute_location': [0, 18], 'local_location': [0, 3], 'material_type': 'Air', 'passable': True}, {'absolute_location': [0, 19], 'local_location': [0, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [0, 20], 'local_location': [0, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [0, 21], 'local_location': [0, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [0, 22], 'local_location': [0, 7], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 15], 'local_location': [1, 0], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 16], 'local_location': [1, 1], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 17], 'local_location': [1, 2], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 18], 'local_location': [1, 3], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 19], 'local_location': [1, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 20], 'local_location': [1, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 21], 'local_location': [1, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [1, 22], 'local_location': [1, 7], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 15], 'local_location': [2, 0], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 16], 'local_location': [2, 1], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 17], 'local_location': [2, 2], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 18], 'local_location': [2, 3], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 19], 'local_location': [2, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 20], 'local_location': [2, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 21], 'local_location': [2, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [2, 22], 'local_location': [2, 7], 'material_type': 'Air', 'passable': True}, {'absolute_location': [3, 15], 'local_location': [3, 0], 'material_type': 'Air', 'passable': True}, {'absolute_location': [3, 16], 'local_location': [3, 1], 'material_type': 'Air', 'passable': True}, {'absolute_location': [3, 17], 'local_location': [3, 2], 'material_type': 'Air', 'passable': True}, {'absolute_location': [3, 18], 'local_location': [3, 3], 'material_type': 'player', 'passable': False}, {'absolute_location': [3, 19], 'local_location': [3, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [3, 20], 'local_location': [3, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [3, 21], 'local_location': [3, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [3, 22], 'local_location': [3, 7], 'material_type': 'Air', 'passable': True}, {'absolute_location': [4, 15], 'local_location': [4, 0], 'material_type': 'Wooden_Wall', 'passable': False}, {'absolute_location': [4, 16], 'local_location': [4, 1], 'material_type': 'Wooden_Wall', 'passable': False}, {'absolute_location': [4, 17], 'local_location': [4, 2], 'material_type': 'Wooden_Wall', 'passable': False}, {'absolute_location': [4, 18], 'local_location': [4, 3], 'material_type': 'Wooden_Wall', 'passable': False}, {'absolute_location': [4, 19], 'local_location': [4, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [4, 20], 'local_location': [4, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [4, 21], 'local_location': [4, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [4, 22], 'local_location': [4, 7], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 15], 'local_location': [5, 0], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 16], 'local_location': [5, 1], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 17], 'local_location': [5, 2], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 18], 'local_location': [5, 3], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 19], 'local_location': [5, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 20], 'local_location': [5, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 21], 'local_location': [5, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [5, 22], 'local_location': [5, 7], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 15], 'local_location': [6, 0], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 16], 'local_location': [6, 1], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 17], 'local_location': [6, 2], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 18], 'local_location': [6, 3], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 19], 'local_location': [6, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 20], 'local_location': [6, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 21], 'local_location': [6, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [6, 22], 'local_location': [6, 7], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 15], 'local_location': [7, 0], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 16], 'local_location': [7, 1], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 17], 'local_location': [7, 2], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 18], 'local_location': [7, 3], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 19], 'local_location': [7, 4], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 20], 'local_location': [7, 5], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 21], 'local_location': [7, 6], 'material_type': 'Air', 'passable': True}, {'absolute_location': [7, 22], 'local_location': [7, 7], 'material_type': 'Air', 'passable': True}], 'house_id': 'a2947d7b-00d0-4054-ae82-f00667bf8a73', 'player_location': [3, 18], 'success': True}


async def start_main():
    display: Display = Display(oled_h)
    _thread.start_new_thread(display.run, ())

    # winking_potato = QueueItem("animation", WINKING_POTATO, 0.08)
    # for i in range(0, 5):
    #     display.queue_item(winking_potato)
    # display.queue_item(QueueItem("clear"))

    # queue_item = QueueItem("house_render", house)
    # display.render_house(queue_item)


if __name__ == '__main__':
    while True:
        asyncio.run(start_main())
        print("Restarting main thread...")
        time.sleep(1)
